<!DOCTYPE html>
<html>
  	<head>
      <meta charset="UTF-8">
      <title>Regular Expression Tookit</title>
    </head>
  	<style type="text/css">
      @font-face {
        font-family: 'Marmelad';
        font-style: normal;
        font-weight: 400;
        src: local('Marmelad'), local('Marmelad-Regular'), url(HM9p0JaHv5-HhbhN_csF8vesZW2xOQ-xsNqO47m55DA.woff) format('woff');
      }
      html {
        background-color: #f0f0f0;
      }
  		body {
        padding: 2px;
  			font-size: 16px;
        font-family: 'Marmelad', sans-serif, '微软雅黑';
  		}
  		#up, #down {
  			width: 100%;
  		}
  		#down {
  			position: relative;
        top: 0px;
        left: 0px;
  		}
  		#test-text {
        position: absolute;
        top: 23px;
        left: 0px;
        z-index: 100;
        background: rgba(0,0,0,0);
  		}
  		#test-text-render {
        position: absolute;
        top: 23px;
        left: 0px;
        z-index: 10;
        margin: 0px;
        padding: 1px;
  			width: 100%;
        height: 300px;
        font-size: 16px;
        font-family: 'Marmelad', sans-serif, '微软雅黑';
        color: rgba(0,0,0,0);
  		}
      #regex-text {
        height: 100px;
      }
  		textarea {
        margin: 0px;
        padding: 0px;
  			width: 100%;
  			height: 300px;
        resize: none;
        outline: none;
        font-size: 16px;
        font-family: 'Marmelad', sans-serif, '微软雅黑';
        color: #333;
        border: solid 1px #999;
  		}
  		span {
        margin: 0px;
        padding: 0px;
        border: none;
        font-size: 16px;
        font-family: 'Marmelad', sans-serif, '微软雅黑';
  		}
      span:nth-child(odd) {
        background: #88f;
      }
      span:nth-child(even) {
        background: #f88;
      }
  	</style>
  	<body>
    	<div id="up">
    		<label>Regular Expressions</label>
    		<textarea id="regex-text"></textarea>
    	</div>

    	<div id="down" style="height: 325px;">
        <div>
          <label>Text</label>
          <label style="font-size:13px;">
            <input type="checkbox" value="g" class="pattern_attr"/>
            全局匹配
          </label>
          <label style="font-size:13px;">
            <input type="checkbox" value="i" class="pattern_attr"/>
            区分大小写
          </label>
          <label style="font-size:13px;">
            <input type="checkbox" value="m" class="pattern_attr"/>
            多行匹配
          </label>
        </div>
    		<textarea id="test-text"></textarea>
    		<pre id="test-text-render"></pre>
    	</div>

    	<script type="text/javascript">
        var p_a = document.getElementsByClassName('pattern_attr');
        
        for(var i=0; i < p_a.length; i++) {
          p_a[i].addEventListener('click', function(e){
            var attrs = '';
            for(var j=0; j < p_a.length; j++) {
              if(p_a[j].checked) {
                attrs += p_a[j].value;
              }
            }
            pattern = new regexText
          }, false);
        }

        regexContext = {
          text: '',
          pattern_text: '',
          pattern_attrs: '',
          setRegExp: function(patternText, attributes){
            this.pattern = new RegExp('(' + patternText + ')', attributes);
          },
          renderText: function(){
            return this.text.replace(this.pattern, '<span>$1</span>');
          } 
        };


    		var down = document.getElementById('down');
    		// down.addEventListener('click',function(){
    		// 	console.log('down click');
    		// });

    		var regexText = document.getElementById('regex-text');

    		regexText.addEventListener('keyup',function(e){
    			console.log('up keydown');
    			// 取得正则表达式
    			pattern = regexText.value;
    			console.log('The regex input is : ' + pattern);

    			if(pattern == '' || pattern == undefined) {
    				//document.getElementById('test-text').value = text;
    				document.getElementById('test-text-render').innerHTML = text;
    				return;
    			}

    			result = renderTextByRegex(text, pattern);

    			console.log('result is : ' + result);

    			// 重新写到#test-text
    			//document.getElementById('test-text').value = result;
    			document.getElementById('test-text-render').innerHTML = result;
    		});

    		var text = '';
    		document.getElementById('test-text').addEventListener('keyup', function(e){
    			text = this.value;

          result = renderTextByRegex(text, pattern);

    			document.getElementById('test-text-render').innerHTML = result;
    		});




        //////////////////////////////////////////
        function renderTextByRegex(text, pattern) {
          // 进行正则处理
          _pattern = new RegExp('(' + pattern + ')',"g");
          var result = '';
          
          console.log('pattern is : ' + _pattern);

          result = text.replace(_pattern, '<span>$1</span>');

          return result;
        }
    	</script>
  	</body>
</html>